<!DOCTYPE html>
<meta charset="UTF-8" lang="pt-br">
<title>Bar Routes</title>
<head>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC93QqwB1SGrVxEHcaXM38eCN9hlNq8aNE&libraries=places,geometry&callback=initMap" async defer></script>
    <link rel="stylesheet" href="/static/styles.css" type="text/css">
    <link href="https://fonts.googleapis.com/css2?family=Passion_One:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  
   <div id="map"></div>
    <div class="conteiner">
    <div class="zabu">
        <h1>
            Bar route <img class="beer" src="/static/761866.jpeg"></img>
            <br><br><br><br>
            <div>
                <form action="/" method="post">
                    <input type="hidden" value="A" name = "valorA">
                    <input type="hidden" value="E" name = "valorE">
                    <input type="submit" class="but">
                </form>
            </div>
            
        </h1>
    </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
    
    initMap();
});
var map;
var service;

async function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
        center: { latitude: -34.397, longitude: 150.644 },
        zoom: 15
    });

    service = new google.maps.places.PlacesService();

    var request = {
        location: new google.maps.LatLng(latitude, longitude),
        radius: 500, // Raio de busca em metros
        type: ['bar']  // Tipo de lugar a ser procurado (no caso, bares)
    };

    service.nearbySearch(request, callback);
}

function callback(results, status) {
    if (status == google.maps.places.PlacesServiceStatus.OK) {
        var placesWithDistances = [];

        for (var i = 0; i < results.length; i++) {
            var place = results[i];

            // Calcula a distância entre a localização atual e o lugar
            var distance = google.maps.geometry.spherical.computeDistanceBetween(
                new google.maps.LatLng(latitude, longitude),
                place.geometry.location
            );

            // Crie um objeto com os detalhes do lugar e a distância
            var placeWithDistance = {
                name: place.name,
                address: place.vicinity,
                distance: distance
            };

            placesWithDistances.push(placeWithDistance);
        }

        // Transforme o array em um JSON
        var placesJSON = JSON.stringify(placesWithDistances);
        document.getElementsByName("valueA").values = placesJSON

        // Faça algo com o JSON (por exemplo, envie-o para o servidor ou exiba-o na página)
        console.log(placesJSON);
    }
}

    </script>
    
</body>

