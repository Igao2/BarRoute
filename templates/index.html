<!DOCTYPE html>
<meta charset="UTF-8" lang="pt-br">
<title>Bar Routes</title>
<head>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC93QqwB1SGrVxEHcaXM38eCN9hlNq8aNE&libraries=places&callback=initMap"></script>
    <link rel="stylesheet" href="/static/styles.css" type="text/css">
    <link href="https://fonts.googleapis.com/css2?family=Passion_One:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  
   
    <div class="conteiner">
    <div class="zabu">
        <h1>Bar route</h1> <img class="beer" src="/static/761866.jpeg"></img>
            <br><br><br><br>
           
       

            <div id="map" style="height: 200px;"></div>

            <div>
                <form action="/" method="post">
                    <input type="hidden" value="A" name = "valorA">
                    <input type="hidden" value="E" name = "valorE">
                    <input type="submit" class="but">
                </form>
            </div>
    </div>
    
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
    
    getLocation()
});
var map;
var service;

const placesClient = new google.maps.places.PlacesClient(
  {
    key: "AIzaSyC93QqwB1SGrVxEHcaXM38eCN9hlNq8aNE"
  }
);

    function getLocation() {
  // Chama o método getCurrentPosition() da API de Geolocalização
  navigator.geolocation.getCurrentPosition(
    function(position) {
      // Armazena a localização atual em um objeto Position


    // Get the Google Places object
    var places = google.maps.places;
      var location = position;
        
     var latitude = position.coords.latitude;
    var longitude = position.coords.longitude;
    console.log(latitude)
    console.log(longitude)

    initMap(latitude,longitude)
    
    },
    function(error) {
      // Erro ao obter a localização do usuário
      console.log(error);
    }
  );
}





function initMap(latitude,longitude) {
            const sydney = new google.maps.LatLng(latitude,longitude);
            infowindow = new google.maps.InfoWindow();
            map = new google.maps.Map(document.getElementById("map"), {
                center: sydney,
                zoom: 15,
            });
          
            var request = {
            location: sydney,
            radius: '5000',
            type: ['bar']
            };
          
            service = new google.maps.places.PlacesService(map);
            service.nearbySearch(request, callback);
          }
          function callback(results, status) {
          if (status == google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
          createMarker(results[i]);
          }
        }
}
          
          function createMarker(place) {
            if (!place.geometry || !place.geometry.location) return;
          
            const marker = new google.maps.Marker({
              map,
              position: place.geometry.location,
            });
            
          
            google.maps.event.addListener(marker, "click", () => {
              infowindow.setContent(place.name || "");
              infowindow.open(map);
            });
          }
          
          window.initMap = initMap()




    </script>
    
</body>

